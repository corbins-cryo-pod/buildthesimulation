---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import DevicesDirectory from "../../components/DevicesDirectory";

const entries = (await getCollection("designs"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => a.data.order - b.data.order);

function stripPrefix(title) {
  return title.replace(/^\d+\s*—\s*/, "");
}

const normalized = entries.map((p) => ({
  title: stripPrefix(p.data.title),
  slug: p.slug,
  description: p.data.description ?? "",
  order: p.data.order,
  device_id: p.data.device_id ?? "",
  interface_class: p.data.interface_class,
  status: p.data.status,
  modality: p.data.modality,
  tags: p.data.tags ?? [],
}));

const allTags = normalized.flatMap((e) => e.tags ?? []);
---

<Layout
  pageTitle="Devices"
  subtitle="A directory of brain–computer interface devices and related neural interface systems."
  description="BCI Devices: a directory of architectures and devices, with search and tag filtering."
>
  <section class="card">
    <p class="muted">
      This is the long-term catalog: not companies, but the actual <em>devices</em> (arrays, films, cuffs, stents,
      packaging approaches).
    </p>
  </section>

  <DevicesDirectory client:load entries={normalized} allTags={allTags} />
</Layout>

<style>
  .card {
    margin-top: 14px;
    padding: 22px 22px;
    border-radius: 16px;
    border: 1px solid var(--border);
    background: var(--panel);
  }

  .muted {
    opacity: 0.72;
    margin: 0;
    line-height: 1.7;
  }
</style>
