---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const all = await getCollection("articles");
const posts = all
  .filter((p) => !p.data.draft)
  .sort((a, b) => a.data.order - b.data.order);

const phase1 = posts.filter((p) => p.data.order >= 1 && p.data.order <= 6);
const phase2 = posts.filter((p) => p.data.order >= 7 && p.data.order <= 10);
const phase3 = posts.filter((p) => p.data.order >= 11 && p.data.order <= 14);

// Keep the simulation-led pieces together, and split company briefs into their own phase
// so they don't get buried at the bottom of the long list.
const phase4 = posts.filter((p) => p.data.order >= 15 && p.data.order <= 18);
const phase5 = posts.filter((p) => p.data.order >= 19);

function titleWithoutPrefix(title) {
  return title.replace(/^\d+\s*—\s*/, "");
}
---

<Layout
  pageTitle="Articles"
  subtitle="A guided sequence from fundamentals → existing tech → future biohybrid peripheral nerve interfaces."
  description="A sequenced set of articles on brain-computer interfaces, peripheral regenerative nerve interfaces, and biohybrid neuroengineering."
>
  <section class="card">
    <p class="muted">
      This is meant to read like an evolving textbook: rigorous definitions + citations, but also practical engineering heuristics.
    </p>
  </section>

  <section class="card">
    <h2>Phase 1 — Foundations + existing tech (complete)</h2>
    <div class="list">
      {phase1.map((p) => (
        <a class="item" href={`/articles/${p.slug}/`}>
          <div class="top">
            <h3>
              {String(p.data.order).padStart(2, "0")} — {titleWithoutPrefix(p.data.title)}
            </h3>
          </div>
          {p.data.description ? <p class="desc">{p.data.description}</p> : null}
        </a>
      ))}
    </div>
  </section>

  {phase2.length ? (
    <section class="card">
      <h2>Phase 2 — Materials, mechanics, and biology of chronic implants</h2>
      <div class="list">
        {phase2.map((p) => (
          <a class="item" href={`/articles/${p.slug}/`}>
            <div class="top">
              <h3>
                {String(p.data.order).padStart(2, "0")} — {titleWithoutPrefix(p.data.title)}
              </h3>
            </div>
            {p.data.description ? <p class="desc">{p.data.description}</p> : null}
          </a>
        ))}
      </div>
    </section>
  ) : null}

  {phase3.length ? (
    <section class="card">
      <h2>Phase 3 — Biohybrid peripheral regenerative interfaces (open exploration)</h2>
      <div class="list">
        {phase3.map((p) => (
          <a class="item" href={`/articles/${p.slug}/`}>
            <div class="top">
              <h3>
                {String(p.data.order).padStart(2, "0")} — {titleWithoutPrefix(p.data.title)}
              </h3>
            </div>
            {p.data.description ? <p class="desc">{p.data.description}</p> : null}
          </a>
        ))}
      </div>
    </section>
  ) : null}

  {phase5.length ? (
    <section class="card">
      <h2>Phase 4 — BCI company briefs (ongoing)</h2>
      <p class="muted" style="margin-top:-4px; margin-bottom:12px;">
        Quick, tech-first snapshots of key companies. (Moved into their own phase so they’re easy to find.)
      </p>
      <div class="list">
        {phase5.map((p) => (
          <a class="item" href={`/articles/${p.slug}/`}>
            <div class="top">
              <h3>
                {String(p.data.order).padStart(2, "0")} — {titleWithoutPrefix(p.data.title)}
              </h3>
            </div>
            {p.data.description ? <p class="desc">{p.data.description}</p> : null}
          </a>
        ))}
      </div>
    </section>
  ) : null}

  {phase4.length ? (
    <section class="card">
      <h2>Phase 5 — Simulation-led design</h2>
      <div class="list">
        {phase4.map((p) => (
          <a class="item" href={`/articles/${p.slug}/`}>
            <div class="top">
              <h3>
                {String(p.data.order).padStart(2, "0")} — {titleWithoutPrefix(p.data.title)}
              </h3>
            </div>
            {p.data.description ? <p class="desc">{p.data.description}</p> : null}
          </a>
        ))}
      </div>
    </section>
  ) : null}
</Layout>

<style>
  .card {
    margin-top: 14px;
    padding: 22px 22px;
    border-radius: 16px;
    border: 1px solid rgba(10, 10, 12, 0.14);
    background: rgba(255, 255, 255, 0.22);
  }

  .muted {
    opacity: 0.72;
    margin: 0;
  }

  h2 {
    margin: 0 0 12px;
    font-size: 1.15em;
    font-weight: 700;
  }

  .list {
    display: grid;
    gap: 10px;
  }

  .item {
    display: block;
    padding: 14px 14px;
    border-radius: 14px;
    border: 1px solid rgba(10, 10, 12, 0.14);
    background: rgba(255, 255, 255, 0.16);
    color: inherit;
    text-decoration: none;
  }

  .item:hover {
    border-color: rgba(10, 10, 12, 0.28);
    transform: translateY(-1px);
    background: rgba(255, 255, 255, 0.24);
  }

  h3 {
    margin: 0;
    font-size: 1.05em;
    font-weight: 700;
  }

  .desc {
    margin: 8px 0 0;
    opacity: 0.78;
    line-height: 1.7;
  }
</style>
